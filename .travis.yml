language: c
os:
  - linux
  - osx
dist: focal
compiler:
  - gcc
  - clang
before_install:
  - .ci/dependencies.sh
addons:
  apt:
    update: true
script: .ci/build.sh
after_success:
  # Generate the docs only if master, the travis_build_docs is true and we can use secure variables
  - >-
    TRAVIS_ALLOW_FAILURE=true
    if [[ "$TRAVIS_BRANCH" = "master" && -n "$TRAVIS_BUILD_DOCS" && "$TRAVIS_PULL_REQUEST" = "false" ]] ; then
      if [[ "$TRAVIS_OS_NAME" = "linux"]] ; then
        if [[ "$TRAVIS_COMPILER" = "gcc" ]]; then
          source .ci/setup-ssh.sh || travis_terminate 1
          .ci/generateDocumentation.sh || travis_terminate 1
        fi
      fi
    fi
